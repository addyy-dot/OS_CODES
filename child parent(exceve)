// child.cpp
#include <bits/stdc++.h> 
#include <cstdlib>

using namespace std;

int main(int argc, char *argv[]) {
    if (argc < 2) {
        cout << "CHILD: No array received from parent." << endl;
        exit(1);
    }

    int n = argc - 1;
    vector<int> arr;
    arr.reserve(n);

    cout << "\n--- Child Process Started ---" << endl;
    cout << "CHILD: Received sorted array: ";
    
    // 1. Convert C-style string arguments back to integers
    for (int i = 0; i < n; i++) {
        try {
            // Use stoi (string to integer)
            arr.push_back(stoi(argv[i + 1]));
            cout << arr[i] << " ";
        } catch (const exception& e) {
            cerr << "\nCHILD: Error converting '" << argv[i+1] << "'." << endl;
            exit(1);
        }
    }
    cout << endl;


    int key;
    cout << "CHILD: Enter element to search for: ";
    cin >> key;

    auto it = lower_bound(arr.begin(), arr.end(), key);

    if (it != arr.end() && *it == key) {
        int index = distance(arr.begin(), it);
        cout << "CHILD: Element " << key << " FOUND at index " << index << "." << endl;
    } else {
        cout << "CHILD: Element " << key << " NOT found in the array." << endl;
    }
    
    cout << "--- Child Process Finished ---" << endl;
    return 0;

// parent.cpp
#include <bits/stdc++.h> // Includes iostream, vector, algorithm, etc.
using namespace std;

// C headers for OS system calls
// These are still needed for POSIX functions
#include <unistd.h>     // For fork(), execve()
#include <sys/wait.h>   // For wait()
#include <cstdlib>      // For exit(), perror(), malloc()
#include <cstdio>       // For sprintf()

int main() {
    int n;
    cout << "Enter number of elements: ";
    cin >> n;

    vector<int> arr(n);
    cout << "Enter elements: ";
    for (int i = 0; i < n; i++) {
        cin >> arr[i];
    }

    // 1. Sort using the efficient std::sort (no 'std::' needed)
    sort(arr.begin(), arr.end());

    cout << "Parent sorted array: ";
    for (int val : arr) {
        cout << val << " ";
    }
    cout << endl;

    // 2. Fork - This is the C system call
    pid_t pid = fork();

    if (pid < 0) {
        perror("Fork failed");
        exit(1);
    }

    if (pid == 0) {
        // --- Child Process ---
        // 3. Prepare C-style arguments for execve
        char *args[n + 2];
        args[0] = (char*)"./child";

        for (int i = 0; i < n; i++) {
            char *buf = (char*)malloc(12);
            if (buf == NULL) {
                perror("malloc failed");
                exit(1);
            }
            sprintf(buf, "%d", arr[i]);
            args[i + 1] = buf;
        }
        args[n + 1] = NULL;

        // 4. Replace child process
        execve("./child", args, NULL);
        
        // execve() only returns if it fails
        perror("execve failed");
        exit(1);

    } else {
        // --- Parent Process ---
        // 5. Wait for the child to finish
        wait(NULL);
        cout << "Parent: Child process finished." << endl;
    }

    return 0;
}



}
